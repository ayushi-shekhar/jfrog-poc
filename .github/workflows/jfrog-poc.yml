name: JFrog Maven POC

on:
  push:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Setup Java
        uses: actions/setup-java@v4
        with:
          distribution: temurin
          java-version: 21

      - name: Setup JFrog CLI
        uses: jfrog/setup-jfrog-cli@v4
        env:
          JF_URL: ${{ secrets.JF_URL }}
          JF_ACCESS_TOKEN: ${{ secrets.JF_ACCESS_TOKEN }}

      - name: Configure JFrog Server
        run: |
          jfrog config add my-server \
            --url=${{ secrets.JF_URL }} \
            --access-token=${{ secrets.JF_ACCESS_TOKEN }} \
            --interactive=false

      - name: Configure Maven for JFrog
        working-directory: simple-java-maven-app-master
        run: |
          jfrog mvn-config \
            --repo-resolve-releases=maven-virtual \
            --repo-resolve-snapshots=maven-virtual \
            --repo-deploy-releases=maven-local \
            --repo-deploy-snapshots=maven-local

      - name: Build with JFrog
        working-directory: simple-java-maven-app-master
        run: |
          jfrog mvn clean install \
            --build-name=jfrog-poc \
            --build-number=${{ github.run_number }}

      - name: Publish Build Info
        run: |
          jfrog build-publish jfrog-poc ${{ github.run_number }}